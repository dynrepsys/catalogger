<html>
<head>
<!--script src="https://unpkg.com/randomorg-js/index.js"></script-->
<script type="text/javascript">
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.RandomOrg=t()}(this,function(){function e(e,t){return t={exports:{}},e(t,t.exports),t.exports}function t(e){var t=m.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)}function n(e,t,n){if(!v(t))throw new TypeError("iterator must be a function");arguments.length<3&&(n=this),"[object Array]"===j.call(e)?r(e,t,n):"string"==typeof e?o(e,t,n):s(e,t,n)}function r(e,t,n){for(var r=0,o=e.length;r<o;r++)S.call(e,r)&&t.call(n,e[r],r,e)}function o(e,t,n){for(var r=0,o=e.length;r<o;r++)t.call(n,e.charAt(r),r,e)}function s(e,t,n){for(var r in e)S.call(e,r)&&t.call(n,e[r],r,e)}function i(){for(var e=arguments,t={},n=0;n<arguments.length;n++){var r=e[n];for(var o in r)x.call(r,o)&&(t[o]=r[o])}return t}function a(e,t){for(var n=0;n<e.length;n++)t(e[n])}function u(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function c(e,t,n){var r=e;return M(t)?(n=t,"string"==typeof e&&(r={uri:e})):r=D(t,{uri:e}),r.callback=n,r}function f(e,t,n){return t=c(e,t,n),p(t)}function p(e){function t(){4===a.readyState&&o()}function n(){var e=void 0;if(e=a.response?a.response:a.responseText||d(a),b)try{e=JSON.parse(e)}catch(e){}return e}function r(e){return clearTimeout(l),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,i(e,v)}function o(){if(!p){var t;clearTimeout(l),t=e.useXDR&&void 0===a.status?200:1223===a.status?204:a.status;var r=v,o=null;return 0!==t?(r={body:n(),statusCode:t,method:y,headers:{},url:g,rawRequest:a},a.getAllResponseHeaders&&(r.headers=L(a.getAllResponseHeaders()))):o=new Error("Internal XMLHttpRequest Error"),i(o,r,r.body)}}if("undefined"==typeof e.callback)throw new Error("callback argument missing");var s=!1,i=function(t,n,r){s||(s=!0,e.callback(t,n,r))},a=e.xhr||null;a||(a=e.cors||e.useXDR?new f.XDomainRequest:new f.XMLHttpRequest);var c,p,l,g=a.url=e.uri||e.url,y=a.method=e.method||"GET",h=e.body||e.data,w=a.headers=e.headers||{},m=!!e.sync,b=!1,v={body:void 0,headers:{},statusCode:0,method:y,url:g,rawRequest:a};if("json"in e&&e.json!==!1&&(b=!0,w.accept||w.Accept||(w.Accept="application/json"),"GET"!==y&&"HEAD"!==y&&(w["content-type"]||w["Content-Type"]||(w["Content-Type"]="application/json"),h=JSON.stringify(e.json===!0?h:e.json))),a.onreadystatechange=t,a.onload=o,a.onerror=r,a.onprogress=function(){},a.onabort=function(){p=!0},a.ontimeout=r,a.open(y,g,!m,e.username,e.password),m||(a.withCredentials=!!e.withCredentials),!m&&e.timeout>0&&(l=setTimeout(function(){if(!p){p=!0,a.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",r(e)}},e.timeout)),a.setRequestHeader)for(c in w)w.hasOwnProperty(c)&&a.setRequestHeader(c,w[c]);else if(e.headers&&!u(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(a.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(a),a.send(h||null),a}function d(e){if("document"===e.responseType)return e.responseXML;var t=204===e.status&&e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;return""!==e.responseType||t?null:e.responseXML}function l(){}function g(e){var t=function(t){return function(n,r,o){var s=C.concat?C.concat:C,i=t||e||0|1e3*Math.random();s({url:"https://api.random.org/json-rpc/1/invoke",json:!0,method:"POST",body:{jsonrpc:"2.0",method:n,params:r,id:i}},function(e,t,n){return e?o(e):void o(null,n)})}},n={};return A.forEach(function(e){n[e]=function(n,r,o){n&&"object"==typeof n&&(o=r,r=n,n=!1),t(n)(e,r,o)}}),n.request=t(e),n.RandomOrg=g,n}var y="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},h=e(function(e){"undefined"!=typeof window?e.exports=window:"undefined"!=typeof y?e.exports=y:"undefined"!=typeof self?e.exports=self:e.exports={}}),w=t,m=Object.prototype.toString,b=e(function(e,t){function n(e){return e.replace(/^\s*|\s*$/g,"")}t=e.exports=n,t.left=function(e){return e.replace(/^\s*/,"")},t.right=function(e){return e.replace(/\s*$/,"")}}),v=w,R=n,j=Object.prototype.toString,S=Object.prototype.hasOwnProperty,T=b,X=R,q=function(e){return"[object Array]"===Object.prototype.toString.call(e)},E=function(e){if(!e)return{};var t={};return X(T(e).split("\n"),function(e){var n=e.indexOf(":"),r=T(e.slice(0,n)).toLowerCase(),o=T(e.slice(n+1));"undefined"==typeof t[r]?t[r]=o:q(t[r])?t[r].push(o):t[r]=[t[r],o]}),t},O=i,x=Object.prototype.hasOwnProperty,H=h,M=w,L=E,D=O,C=f;f.XMLHttpRequest=H.XMLHttpRequest||l,f.XDomainRequest="withCredentials"in new f.XMLHttpRequest?f.XMLHttpRequest:H.XDomainRequest,a(["get","put","post","patch","head","delete"],function(e){f["delete"===e?"del":e]=function(t,n,r){return n=c(t,n,r),n.method=e.toUpperCase(),p(n)}});var A=["generateIntegers","generateDecimalFractions","generateGaussians","generateStrings","generateUUIDs","generateBlobs","getUsage","generateSignedIntegers","generateSignedDecimalFractions","generateSignedGaussians","generateSignedStrings","generateSignedUUIDs","generateSignedBlobs","verifySignature"],U=g();return U});
</script>
</head>
<body>
<style>
body {
  margin: 0;
  padding: 0;
}

canvas {
    border: 1px solid blue;
}
</style>

<div style="float:left">
    <canvas id="canvas1" style="margin-left:10;margin-top:10;" width="511" height="511"></canvas>
</div>
<div style="float:left">
    <canvas id="canvas2" style="margin-left:10;margin-top:10;" width="511" height="511"></canvas>
</div>

<script type="text/javascript">
window.addEventListener('load', eventWindowLoaded, false);

const params = {
  apiKey: 'f39fd76c-7106-4588-b5c6-fa175de5644f',
  n: 10,
  min: 1,
  max: 10
}

var randSeed = "9568135715";
var rand = function(){};

var grid1 = [];
var grid2 = [];

const gridHeight = 10;
const gridWidth = 10;

const dx = 20;
const dy = 20;

var workers = [];

function initGrid(grid) {
    for(var j =0; j < gridHeight; j++) {
        grid.push([]);
        for(var i = 0; i < gridWidth; i++) {
            grid[j].push(rand() >= 0.5 ? 1 : 0);
        }
    }
}

function eventWindowLoaded () {
    //initGrid(grid1);
    //console.log(grid1);
    //initGrid(grid2);
    //console.log(grid2);

    var c = document.getElementById('canvas1');
    //alert(c.height + ' ' + c.width);
    c.width = dx * gridWidth + gridWidth + 1;
    c.height= dx * gridHeight + gridHeight + 1;
    //alert(c.height + ' ' + c.width);
    c = document.getElementById('canvas2');
    //alert(c.height + ' ' + c.width);
    c.width = dx * gridWidth + gridWidth + 1;
    c.height= dx * gridHeight + gridHeight + 1;
    //canvasApp();
    initCanvas(canvas1, 0);
    initCanvas(canvas2, 0);

    var randomorg = RandomOrg;
    console.log('init random', randomorg);
    getSeed(randomorg);

    //var worker1 = new Worker('worker.js');
}

function initGrids() {
    initGrid(grid1);
    console.log(grid1);
    for(var j =0; j < gridHeight; j++) {
        for(var i = 0; i < gridWidth; i++) {
            if(grid1[j][i] == 1) {
                fillCell(i, j, canvas1, 0);
            }
        }
    }
    initGrid(grid2);
    console.log(grid2);
    for(var j =0; j < gridHeight; j++) {
        for(var i = 0; i < gridWidth; i++) {
            if(grid2[j][i] == 1) {
                fillCell(i, j, canvas2, 0);
            }
        }
    }
    initWorkers();
}

function initWorkers() {
    for(var j = 0; j < gridHeight; j++) {
        workers.push([]);
        for(var i = 0; i < gridWidth; i++) {
            workers[j].push(new Worker('worker.js'));
            workers[j][i].onmessage = onWorkerMessage;
            var seed = Math.floor(rand() * 10000000000) + '';
            workers[j][i].postMessage({ method: 'init', args: [seed, i, j, 99] });
        }
    }
}

var methods = {
    ready: function(name, x, y) {
        //console.log(name, 'ready');
        workers[y][x].postMessage({ method: 'next', args: [] });
    },
    peek: function(name, x, y, pos, bits, hov, dir) {
        //console.log(name, 'peek', pos, x, y, bits, hov, dir);
        var grid = ( pos ? grid2 : grid1 );
        var v0 = grid[y][x];
        var v1 = -1;
        if(bits) {
            v1 = adj(grid, x, y, hov, dir);
        }
        workers[y][x].postMessage({ method: 'show', args: [v0, v1] });
    },
    update: function(name, x, y, pos, out) {
        //console.log(name, 'updated', x, y, pos, out);
        var grid = (pos == 0 ? grid1 : grid2);
        var canvas = (pos == 0 ? canvas1 : canvas2);
        grid[y][x] = out;
        if(grid[y][x] == 1) {
            fillCell(x, y, canvas, 0);
        }
        else {
            clearCell(x, y, canvas, 0);
        }
    },
    done: function(name, x, y) {
        console.log(name, 'done');
        workers[y][x].terminate();
    }
}

function adj(grid, x, y, hov, dir) {
    var x1 = x;
    var y1 = y;
    switch(hov) {
        case 0: //horizontal
            x1 = ( dir ? (x < gridWidth-1 ? x+1 : 0) : (x > 0 ? x-1 : gridWidth-1) );
            break;
        case 1: //vertical
            y1 = ( dir ? (y < gridHeight-1 ? y+1 : 0) : (y > 0 ? y-1 : gridHeight-1) );
            break;
    }
    //console.log('adj', grid, x, y, hov, dir, x1, y1);
    return grid[y1][x1];
}

function onWorkerMessage(e) {
    if (e.data instanceof Object &&
        e.data.hasOwnProperty('method') &&
        e.data.hasOwnProperty('args')) {
        methods[e.data.method].apply(this, e.data.args);
    } else {
        console.log('unknown method', e.data);
    }
}

function getSeed(randomorg) {
    if(randSeed == "") {
    randomorg.generateIntegers(params, (err, response) => {
        // there may have `err` or `response.error`
        console.log(err || response.error);
        // response is exactly what the API spec
        // defines as response object
        console.log(response);
        //console.log(response.id);
        if(response.result && response.result.random) {
            console.log(response.result, response.result.random.data);
            randSeed = response.result.random.data.join('');
            rand = Alea(randSeed);
            console.log(randSeed);
            setTimeout(initGrids, 0);
        }
    });
    }
    else {
        rand = Alea(randSeed);
        console.log(randSeed);
        setTimeout(initGrids, 0);
    }
}

function initCanvas(canvas, offset) {
    if(!!!canvas.getContext)
        return;

    var ctx = canvas.getContext('2d');
    //ctx.lineColor = "#ff0000";

    canvas.left = 0 + offset;
    canvas.top = 0;
    //canvas.width = (gridWidth + 1) * dx + 10;
    //canvas.height = (gridHeight + 1) * dy + 2;

    for(var x = 0; x <= gridWidth; x++) {
        ctx.beginPath();
        ctx.moveTo(x*(dx+1)+0.5, 0);
        ctx.lineTo(x*(dx+1)+0.5, canvas.clientHeight);
        ctx.strokeStyle = "#ff0000";
        ctx.lineWidth = 1;
        ctx.stroke();
    }

    for(var y = 0; y <= gridHeight; y++) {
        ctx.beginPath();
        ctx.moveTo(0, y*(dy+1)+0.5);
        ctx.lineTo(canvas.clientWidth, y*(dy+1)+0.5);
        ctx.strokeStyle = "#00ff00";
        ctx.lineWidth = 1;
        ctx.stroke();
    }
}

function fillCell(x, y, canvas, offset) {
    var ctx = canvas.getContext('2d');
    ctx.fillStyle = "#000000";
    ctx.fillRect(x*(dx+1)+1, y*(dy+1)+1, dx, dy);
}

function clearCell(x, y, canvas, offset) {
    var ctx = canvas.getContext('2d');
    ctx.fillStyle = "#ffffff";
    ctx.fillRect(x*(dx+1)+1, y*(dy+1)+1, dx, dy);
}

function canvasSupport(e) {
    return !!e.getContext;
}

function canvasApp () {
  var myCanvas = document.getElementById('myCanvas');

  if (!canvasSupport(myCanvas)) {
	  return; 
    }
  
  var ctx = myCanvas.getContext('2d');
  
  myCanvas.left = 50;
  myCanvas.top = 50;
  myCanvas.width = window.innerWidth - 100;
  myCanvas.height = window.innerHeight - 100;
  
  function drawScreen () {
    var dx = 50;
    var dy = 50;
    
    var x = 0;
    var y = 0;
    var w = myCanvas.width;
    var h = myCanvas.height;
    
    var xy = 10;
    
    ctx.lineWidth = 1;
    
    while (y < h) {
      y = y + dy;
      ctx.moveTo(x, y);
      ctx.lineTo(w, y);
      ctx.stroke();
      
      ctx.font = "1px Calibri";  
      ctx.fillText(xy, x, y);  
      xy += 10;  
    }
    
    y =0;  
    xy =10; 
    while (x < w) {
      x = x + dx;
      ctx.moveTo(x, y);  
      ctx.lineTo(x,h);  
      ctx.stroke();   
      ctx.font = "1px Calibri";  
      ctx.fillText(xy,x,10);    
      xy+=10;  
    }
  }
  
  drawScreen();


}

function Alea(seed) {
    if(seed === undefined) {seed = +new Date() + Math.random();}
    function Mash() {
        var n = 4022871197;
        return function(r) {
            for(var t, s, u = 0, e = 0.02519603282416938; u < r.length; u++)
            s = r.charCodeAt(u), f = (e * (n += s) - (n*e|0)),
            n = 4294967296 * ((t = f * (e*n|0)) - (t|0)) + (t|0);
            return (n|0) * 2.3283064365386963e-10;
        }
    }
    return function() {
        var m = Mash(), a = m(" "), b = m(" "), c = m(" "), x = 1, y;
        seed = seed.toString(), a -= m(seed), b -= m(seed), c -= m(seed);
        a < 0 && a++, b < 0 && b++, c < 0 && c++;
        return function() {
            var y = x * 2.3283064365386963e-10 + a * 2091639; a = b, b = c;
            return c = y - (x = y|0);
        };
    }();
}
</script>
</body>
</html>
